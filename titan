#!/bin/bash

# Цвета
WHITE='\033[1;37m'
CYAN='\033[1;36m'
RESET='\033[0m'

# Логотип 
lines=(
  "\e[1;36m+-----------------------------------------------------------------------------------------------------------+\e[0m"
  "\e[1;36m|\e[0m  \e[1;33m##  ###  #######  ######   #######  #######  #######  ######   #######  ##  ##   #######  ######         \e[1;36m|\e[0m"
  "\e[1;36m|\e[0m  \e[1;33m### ###  ##   ##  ##  ##   ##       ##         ###    ##  ##     ###    ##  ##   ##       ##  ##         \e[1;36m|\e[0m"
  "\e[1;36m|\e[0m  \e[1;33m#######  ##   ##  ##  ##   ##       #######    ###    ##  ##     ###    ## ##    ##       ##  ##         \e[1;36m|\e[0m"
  "\e[1;36m|\e[0m  \e[1;33m## ####  ##  ###  ### ###  #######       ##    ###    #######    ###    #######  #######  #######        \e[1;36m|\e[0m"
  "\e[1;36m|\e[0m  \e[1;33m##  ###  ##  ###  ### ###  ###      ###  ##    ###    ### ###    ###    ##  ###  ###      ### ###        \e[1;36m|\e[0m"
  "\e[1;36m|\e[0m  \e[1;33m##  ###  ##  ###  ### ###  # #      ###  ##    ###    ### ###    ###    ##  ###  # #      ### ###        \e[1;36m|\e[0m"
  "\e[1;36m|\e[0m  \e[1;33m##  ###  #######  #######  #######  #######    ###    ### ###  #######  ##  ###  #######  ### ###        \e[1;36m|\e[0m"
  "\e[1;36m+-----------------------------------------------------------------------------------------------------------+\e[0m"
  "\e[1;36m|\e[0m                                                                                                           \e[1;36m|\e[0m"
  "\e[1;36m|\e[0m  🔗 \e[1;32mFollow us on Twitter:\e[0m \e[4;34mhttps://x.com/TmBO0o\e[0m 🐦                                                    \e[1;36m|\e[0m"
  "\e[1;36m|\e[0m  💻 \e[1;32mGitHub Repository: \e[0m \e[4;34mhttps://github.com/TmB0o0\e[0m 📁                                                \e[1;36m|\e[0m"
  "\e[1;36m+-----------------------------------------------------------------------------------------------------------+\e[0m"
)

# Меню
while true; do
  clear
  for line in "${lines[@]}"; do
    echo -e "$line"
    sleep 0.05
  done

  # Меню
  echo -e "\n${WHITE}╔═══════════════════════════════╗${RESET}"
  echo -e "${WHITE}║        MANAGEMENT MENU        ║${RESET}"
  echo -e "${WHITE}╚═══════════════════════════════╝${RESET}\n" 

  echo -e "${CYAN}1.${RESET} 🛠️  Install Node"
  echo -e "${CYAN}2.${RESET} 🔗 Add IdentityCode"
  echo -e "${CYAN}3.${RESET} ♻️  Restart Node"
  echo -e "${CYAN}4.${RESET} 📜 View Logs"
  echo -e "${CYAN}5.${RESET} 🧹 Remove Node"
  echo -e "${CYAN}0.${RESET} ❌ Exit"
  echo -ne "\nChoose an option: "
  read choice

  case $choice in
    1)
      echo -e "\n🛠️ Installing dependencies and Docker..."
      sudo apt install -y ca-certificates curl gnupg lsb-release
      docker pull nezha123/titan-edge
      mkdir -p ~/.titanedge
      echo -e "\n✅ Installation completed."
      read -p "Press Enter to return to the menu..."
      ;;
    2)
      echo -e "\n🔗 Starting container and binding IdentityCode..."
      docker run --network=host -d --name titan -v ~/.titanedge:/root/.titanedge nezha123/titan-edge
      echo ""
      echo "⚠️  Please enter your IdentityCode for binding below:"
      read -p "Your IdentityCode: " identity
      docker run --rm -it -v ~/.titanedge:/root/.titanedge nezha123/titan-edge bind --hash=$identity https://api-test1.container1.titannet.io/api/v2/device/binding
      read -p "Press Enter to return to the menu..."
      ;;
    3)
      echo -e "\n♻️ Restarting node..."
      docker run -d -v ~/.titanedge:/root/.titanedge nezha123/titan-edge
      echo -e "✅ Node restarted."
      read -p "Press Enter to return to the menu..."
      ;;
    4)
      echo -e "\n📜 Viewing logs (press Ctrl+C to stop)..."
      docker logs -f titan
      read -p "Press Enter to return to the menu..."
      ;;
    5)
      echo -e "\n🧹 Removing node..."
      docker stop titan
      docker rm titan
      docker rmi nezha123/titan-edge
      rm -rf ~/.titanedge
      echo -e "✅ Node removed."
      read -p "Press Enter to return to the menu..."
      ;;
    0)
      echo -e "\n👋 Exiting..."
      break
      ;;
    *)
      echo -e "\n❌ Invalid option! Please try again."
      sleep 1.5
      ;;
  esac
done
