#!/bin/bash

# Ğ¦Ğ²ĞµÑ‚Ğ°
WHITE='\033[1;37m'
CYAN='\033[1;36m'
RESET='\033[0m'

# Ğ›Ğ¾Ğ³Ğ¾Ñ‚Ğ¸Ğ¿ 
lines=(
  "\e[1;36m+-----------------------------------------------------------------------------------------------------------+\e[0m"
  "\e[1;36m|\e[0m  \e[1;33m##  ###  #######  ######   #######  #######  #######  ######   #######  ##  ##   #######  ######         \e[1;36m|\e[0m"
  "\e[1;36m|\e[0m  \e[1;33m### ###  ##   ##  ##  ##   ##       ##         ###    ##  ##     ###    ##  ##   ##       ##  ##         \e[1;36m|\e[0m"
  "\e[1;36m|\e[0m  \e[1;33m#######  ##   ##  ##  ##   ##       #######    ###    ##  ##     ###    ## ##    ##       ##  ##         \e[1;36m|\e[0m"
  "\e[1;36m|\e[0m  \e[1;33m## ####  ##  ###  ### ###  #######       ##    ###    #######    ###    #######  #######  #######        \e[1;36m|\e[0m"
  "\e[1;36m|\e[0m  \e[1;33m##  ###  ##  ###  ### ###  ###      ###  ##    ###    ### ###    ###    ##  ###  ###      ### ###        \e[1;36m|\e[0m"
  "\e[1;36m|\e[0m  \e[1;33m##  ###  ##  ###  ### ###  # #      ###  ##    ###    ### ###    ###    ##  ###  # #      ### ###        \e[1;36m|\e[0m"
  "\e[1;36m|\e[0m  \e[1;33m##  ###  #######  #######  #######  #######    ###    ### ###  #######  ##  ###  #######  ### ###        \e[1;36m|\e[0m"
  "\e[1;36m+-----------------------------------------------------------------------------------------------------------+\e[0m"
  "\e[1;36m|\e[0m                                                                                                           \e[1;36m|\e[0m"
  "\e[1;36m|\e[0m  ğŸ”— \e[1;32mFollow us on Twitter:\e[0m \e[4;34mhttps://x.com/TmBO0o\e[0m ğŸ¦                                                    \e[1;36m|\e[0m"
  "\e[1;36m|\e[0m  ğŸ’» \e[1;32mGitHub Repository: \e[0m \e[4;34mhttps://github.com/TmB0o0\e[0m ğŸ“                                                \e[1;36m|\e[0m"
  "\e[1;36m+-----------------------------------------------------------------------------------------------------------+\e[0m"
)

# ĞœĞµĞ½Ñ
while true; do
  clear
  for line in "${lines[@]}"; do
    echo -e "$line"
    sleep 0.05
  done

  # ĞœĞµĞ½Ñ
  echo -e "\n${WHITE}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${RESET}"
  echo -e "${WHITE}â•‘        MANAGEMENT MENU        â•‘${RESET}"
  echo -e "${WHITE}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}\n" 

  echo -e "${CYAN}1.${RESET} ğŸ› ï¸  Install Node"
  echo -e "${CYAN}2.${RESET} ğŸ”— Add IdentityCode"
  echo -e "${CYAN}3.${RESET} â™»ï¸  Restart Node"
  echo -e "${CYAN}4.${RESET} ğŸ“œ View Logs"
  echo -e "${CYAN}5.${RESET} ğŸ§¹ Remove Node"
  echo -e "${CYAN}0.${RESET} âŒ Exit"
  echo -ne "\nChoose an option: "
  read choice

  case $choice in
    1)
      echo -e "\nğŸ› ï¸ Installing dependencies and Docker..."
      sudo apt install -y ca-certificates curl gnupg lsb-release
      docker pull nezha123/titan-edge
      mkdir -p ~/.titanedge
      echo -e "\nâœ… Installation completed."
      read -p "Press Enter to return to the menu..."
      ;;
    2)
      echo -e "\nğŸ”— Starting container and binding IdentityCode..."
      docker run --network=host -d --name titan -v ~/.titanedge:/root/.titanedge nezha123/titan-edge
      echo ""
      echo "âš ï¸  Please enter your IdentityCode for binding below:"
      read -p "Your IdentityCode: " identity
      docker run --rm -it -v ~/.titanedge:/root/.titanedge nezha123/titan-edge bind --hash=$identity https://api-test1.container1.titannet.io/api/v2/device/binding
      read -p "Press Enter to return to the menu..."
      ;;
    3)
      echo -e "\nâ™»ï¸ Restarting node..."
      docker run -d -v ~/.titanedge:/root/.titanedge nezha123/titan-edge
      echo -e "âœ… Node restarted."
      read -p "Press Enter to return to the menu..."
      ;;
    4)
      echo -e "\nğŸ“œ Viewing logs (press Ctrl+C to stop)..."
      docker logs -f titan
      read -p "Press Enter to return to the menu..."
      ;;
    5)
      echo -e "\nğŸ§¹ Removing node..."
      docker stop titan
      docker rm titan
      docker rmi nezha123/titan-edge
      rm -rf ~/.titanedge
      echo -e "âœ… Node removed."
      read -p "Press Enter to return to the menu..."
      ;;
    0)
      echo -e "\nğŸ‘‹ Exiting..."
      break
      ;;
    *)
      echo -e "\nâŒ Invalid option! Please try again."
      sleep 1.5
      ;;
  esac
done
